---
title: Automation（構築・検証の自動化）
layout: default
---

# Automation（構築・検証の自動化）

本ドキュメントでは、本プロジェクトにおける  
**構築・起動・検証・復旧を支える自動化スクリプト群**の役割と位置づけを整理します。

目的は、  
**「一度動かした環境」ではなく  
「誰でも同じ結果を再現できる環境」**を作ることです。

---

## 1. 自動化の方針

- 手作業を前提としない
- 実行順を迷わせない
- 失敗時に「どこで止まったか」が分かる
- ログを残し、結果を確認できる

完全なワンコマンド化よりも、  
**理解しやすく、検証・修正しやすい構成**を優先しています。

---

## 2. 再現にかかる時間

- 環境破棄後の再構築：約 **25分**
  - コンテナ起動
  - 初期設定
  - 認証・通信・監視の有効化
  - ヘルスチェック完了まで

※ 実行環境・マシンスペックにより前後します。

---

## 3. スクリプト構成（概要）

| 種別 | スクリプト | 役割 |
|---|---|---|
| 全体起動 | 各 bootstrap スクリプト | 構成単位ごとの初期化・起動 |
| ヘルスチェック | `scripts/multiproxy_health_all.sh` | 全コンテナの稼働状態・依存関係確認 |
| 再起動制御 | `scripts/restart_chain_proxy.sh` | Proxy / stunnel の安全な再起動 |
| 監視自動化 | Zabbix 関連スクリプト | Agent 登録・PSK 設定・初期化 |

---

## 4. ヘルスチェックの考え方

ヘルスチェックでは以下を確認します。

- コンテナが起動しているか
- 依存関係（Proxy → stunnel → Proxy）が崩れていないか
- 異常状態（unhealthy）が残っていないか

単なる `docker ps` ではなく、  
**「通信検証の前提が整っているか」**を確認することを目的としています。

---

## 5. 再起動スクリプトの位置づけ

`restart_chain_proxy.sh` は、

- 設定変更後
- 通信異常発生時
- 検証前の初期化

に使用します。

依存関係を意識せず再起動すると問題が再現しないため、  
**再起動順・設定反映・確認を一体化**しています。

---

## 6. 自動化で得られた効果

- 環境差異による「動かない」を排除
- 検証のやり直しが容易
- 原因切り分けに集中できる

結果として、  
**構成を理解しながら改善できる土台**が整いました。

---

## 7. 今後の改善余地

- 再構築時間の短縮
- ログ・監視初期設定のさらなる自動化
- 異常検知をトリガにした自動復旧

現時点では「再現性」を最優先としていますが、  
将来的には **運用自動化の精度向上**も検討しています。

---

## まとめ

本プロジェクトでは、

- 一から構成を設計し
- 動作する状態まで自動化し
- 何度でも同じ結果を再現できる

という点を重視しました。

これは単なる構築作業ではなく、  
**運用・検証・改善を前提とした設計力の訓練**でもあります。
